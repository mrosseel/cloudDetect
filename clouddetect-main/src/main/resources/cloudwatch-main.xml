<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<import resource="cloudwatch-mail.xml"/>
	<import resource="applicationcontext-jdbc.xml"/>
	<import resource="applicationcontext-dao.xml"/>
	<bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location">
            <value>cloudwatch.properties</value>
        </property>
	</bean>
	
	<!-- Cloudwatcher Application settings -->
	
	<bean id="cloudwatchconfig" class="application.CloudWatchConfig">
		<property name="commandLine"><value>true</value></property>
	</bean>
	
	<bean id="cloudwatchapp" class="application.CloudWatchApp">
		<property name="config"><ref bean="cloudwatchconfig"/></property>
	</bean>
	
	<!-- Image producers -->
	
	<alias name="httpimageproducer" alias="imageproducer"/>
	
	<bean id="fileimageproducer" class="media.image.producer.FileImageProducer">
		<constructor-arg><value>file image producer</value></constructor-arg>
		<property name="imageToLoad"><value>/usr/local/apache2/htdocs/cam1/lastsnap.jpg</value></property>		
		<property name="plugin"><ref bean="nowDatePlugin"/></property>
	</bean>

	<bean id="httpimageproducer" class="media.image.producer.HTTPImageProducer">
		<constructor-arg><value>HTTP image producer</value></constructor-arg>
		<property name="url"><value>${http.url}</value></property>
		<property name="plugin"><ref bean="nowDatePlugin"/></property>
	</bean>
	
	<bean id="directoryimageproducer" class="media.image.producer.DirectoryImageProducer">
		<constructor-arg><value>directory image producer</value></constructor-arg>
		<!--<constructor-arg><value>/usr/local/apache2/htdocs/cam1</value></constructor-arg>-->
		<constructor-arg><value>/home/mike/incoming/movies/20061017</value></constructor-arg>
		<property name="imgExtension"><value>jpg</value></property>
		<property name="looping"><value>0</value></property>
		<property name="fileImageProducer"><ref bean="motionfileimageproducer"/></property>
	</bean>
	
	<bean id="motionfileimageproducer" class="media.image.producer.FileImageProducer">
		<constructor-arg><value>file image producer</value></constructor-arg>
		<property name="plugin"><ref bean="motionFilenameDatePlugin"/></property>
	</bean>
	<bean id="motionFilenameDatePlugin" class="media.image.producer.plugin.MotionFilenameDatePlugin"/>
	<bean id="nowDatePlugin" class="media.image.producer.plugin.NowDatePlugin"/>
	
	<!-- Image Consumers -->	
	
	<bean id="imageconsumer" class="media.image.consumer.ImageConsumerImpl">
	</bean>
	
	<!-- Queues -->	

	<bean id="cloudimagequeue" class="media.image.producer.CloudImageQueue">
		<property name="maxElements"><value>10</value></property>
	</bean>
	
	<!-- Metrics -->	
	
	<bean id="calculatemetriconcloudimage" class="media.processors.CalculateMetricOnCloudImageImpl">
		<property name="metric"><ref bean="manualmetric"/></property>
	</bean>
	
	<bean id="linemediandifferencemetric" class="calculation.LineMedianDifferenceMetric"/>
	<bean id="cutoffdiferencemetric" class="calculation.CutoffDifferenceMetric"/>
	<bean id="minstddevmetric" class="calculation.MinStdDevMetric"/>
	<bean id="manualmetric" class="calculation.ManualMetric">
		<property name="manualSplitterLocation"><value>0.9</value></property>
	</bean>
	<bean id="pixelbrightnessmetric" class="calculation.PixelBrightnessMetric"/>
	<bean id="kmeansmetric" class="calculation.KMeansMetric"/>
	<bean id="horizonmetric" class="calculation.HorizonBlablaMetric"/>
	
	<!--  Cloud Judging -->
		
	<bean id="cloudjudge" class="calculation.CloudJudge">
		<property name="maxClear"><value>1</value></property>
		<property name="maxPartialClear"><value>2</value></property>
	</bean>
	
	<bean id="cloudjudgesubconsumer" class="media.image.consumer.CloudJudgeSubConsumer">
		<property name="transitionWaitInMinutes"><value>${cloudjudge.transitionWaitInMinutes}</value></property>
		<property name="cloudJudge"><ref bean="cloudjudge"/></property>
		<property name="notifier"><ref bean="dummynotify"/></property>
	</bean>
	
	<bean id="savechartfromdbsubconsumer" class="media.image.consumer.SaveChartFromDBSubConsumer">
		<property name="saveFilename"><value>${chart.savefilename}</value></property>
		<property name="nrOfHours" value="24"/>
	</bean>
	
	<bean id="persistresulttodbsubconsumer" class="media.image.consumer.PersistResultToDBSubConsumer">
		<property name="dao"><ref bean="resultdao"/></property>
	</bean>
	<bean id="imagescoringsubconsumer" class="media.image.consumer.ImageScoringSubConsumer">
		<property name="metricOnCloudImage"><ref bean="calculatemetriconcloudimage"/></property>
	</bean>
	
	
	<bean id="soundnotify" class="notification.SoundNotify"/>
	<bean id="dummynotify" class="notification.DummyNotify"/>
	
	<!--  UI -->

	<!-- still needed after chart cleanup? -->	
	<bean id="contrastchart" class="ui.ContrastChart">
	</bean>
	
	<bean id="imagepanel" class="ui.ImagePanel"/>
</beans>
